package POO_AgendaDigital.Infraestrutura;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import CC_AgendaDigital.Core.Compromisso;
import POO_AgendaDigital.Core.Pessoa;

public class SQLite {
	private static Connection conn;
	private static Statement stm;

	public SQLite(String arquivo) {
		try {
			Class.forName("org.sqlite.JDBC");
			conn = DriverManager.getConnection("jdbc:sqlite:" + arquivo);
			stm = conn.createStatement();
		} catch (Exception e) {
			e.getMessage();
		}

		createTables();
	}

	/**
	 * Recebe como parametro uma Pessoa e insere ela no Banco de Dados.
	 * 
	 * @param pessoa
	 */
	public static void insertPessoa(Pessoa pessoa) {
		try {
			stm = conn.createStatement();
			stm.executeUpdate("INSERT INTO Pessoa (Nome, DataNasc, Idade) " + "VALUES ('" + pessoa.getNome() + "', '"
					+ pessoa.getDataNascimento() + "', " + pessoa.getIdade() + ")");
			// stm.cancel();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/**
	 * Método que recebe todas as pessoas que estão no Banco de Dados.
	 * 
	 * @return ArrayList<Pessoa>
	 */
	public static ArrayList<Pessoa> getPessoas() {

		ArrayList<Pessoa> auxPessoas = new ArrayList<Pessoa>();
		ResultSet rs;

		try {

			rs = stm.executeQuery("SELECT * FROM Pessoa");
			while (rs.next()) {
				auxPessoas.add(new Pessoa(rs.getInt("PessoaId"), rs.getString("Nome"), rs.getInt("Idade"),
						rs.getString("DataNasc")));
			}
			rs.close();
			
		} catch (Exception e) {
			// TODO: handle exception
		}
		return auxPessoas;
	}

	public static void insertCompromisso(Compromisso Compromisso) {

		try {
			stm = conn.createStatement();
			stm.executeUpdate(
					"INSERT INTO [Compromisso](CompromissoId, PessoaId, NomeCompromisso, Dias, HoraInicial, HoraFinal) "
							+ "VALUES (" + Compromisso.getCompromissoId() + ", " + Compromisso.getPessoaId() + ", '"
							+ Compromisso.getNomeCompromisso() + "', " + Compromisso.getDias() + ", '"
							+ Compromisso.getHoraInicial() + "', '" + Compromisso.getHoraFinal() + "')");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
	
	private void createTables() {
		try {
			stm = conn.createStatement();

			// Pessoa
			stm.executeUpdate("CREATE TABLE IF NOT EXISTS Pessoa (PessoaId INTEGER PRIMARY KEY NOT NULL"
					+ ", Nome VARCHAR(30) NOT NULL, DataNasc VARCHAR(10) NOT NULL, Idade INTEGER NOT NULL)");

			// Compromisso
			stm.executeUpdate("CREATE TABLE IF NOT EXISTS [Compromisso] (CompromissoId INTEGER PRIMARY KEY"
					+ ", PessoaId INTEGER, NomeCompromisso VARCHAR(20) NOT NULL, Dias INTEGER NOT NULL"
					+ ", HoraInicial VARCHAR(5) NOT NULL, HoraFinal VARCHAR(5) NOT NULL" + ", FOREIGN KEY ([PessoaId]) "
					+ "  REFERENCES [Pessoa] ([PessoaId]))");

		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
